%=========================================================================
% (c) 2011, 2012 Josef Lusticky

\chapter{Introduction}
Nowadays we live in a world where embedded systems are part of almost every electronic device.
Modern televisions contain embedded systems to allow you to browse the Web,
modern cars use embedded systems to control an engine or to give you summary
of your journey using GPS, even fridges showing the list of things you should buy at a market are becoming popular.
Embedded systems are becoming spread more than ever and so does
their need for a network connection.

Contiki is an operating system targeted at embedded systems and
developed by Adam Dunkels at Swedish Institute of Computer Science in Kista, Sweden.
Contiki brings new concepts to the embedded world and features the
Internet Protocol version 6 and 4 support.
Since Contiki aims for maximum portability, it is written in the C programming language.
Contiki therefore provides an ideal solution to connect
embedded systems to an existing network on many different hardware platforms.

Time synchronisation is also important nowadays.
Almost every modern system needs to know the time -
your video-recorder or home cinema automatically starts recording a film at the scheduled time,
your washing-machine should have finished the
desired program when you return home or your radio automatically adjusts its clock when the time changes
due to daylight saving.

Network Time Protocol (NTP) is a ubiquitous protocol for time synchronisation between computers in the modern Internet.
Though being one of the oldest protocols, NTP is still developed and updated to conform to the latest
network standards. Actual version at the time of writing is NTP version~4, which updates its previous version to
accommodate Internet Protocol version~6.

This thesis describes the operating system Contiki, its concepts and philosophy,
Network Time Protocol version~4 and design and implementation of an NTP client for the Contiki operating system.


\input{contiki.tex}

\input{ntp.tex}

\input{analysis.tex}

\input{design.tex}

\input{implementation.tex}

\input{measurements.tex}


\chapter{Conclusion}
The Network Time Protocol has been operating over 30 years as of early 2012
and remains the longest running, continuously operating application
protocol in the Internet~\cite{ntp-y2k}.
This thesis demonstrated, that its use can be further extended to a new platform of constrained devices,
such as embedded systems.

The developed time interface extends Contiki OS towards the real-time support,
while requiring minimal memory amounts.
This interface provides new calls to get, set and adjust the system time without any modification
of the existing code.
The clock library was extended to provide a platform-agnostic hardware clock interface
with a minimal memory overhead.
The time interface could therefore be ported to different hardware platforms easily.
The call for getting the time provides the maximum precision the hardware clock allows.
Setting the time is only possible within one second precision in order to avoid
a misbehaviour of the existing timer libraries.
The time adjustments, that require sophisticated clock discipline algorithms,
were due to a complicated design and memory constraints not implemented.

The developed NTP client for Contiki OS uses the developed time interface to keep an accurate time on the device.
The Contiki NTP client is able to use the NTP unicast and broadcast modes.
The unique timestamp conversion provides a portable solution to avoid
memory expensive floating point or 64-bit arithmetic operations in a constrained environment.
The measurements show that the Contiki NTP client provides an accurate time
synchronisation mechanism to the Contiki operating system.
The Contiki NTP client is a Simple Network Time Protocol client,
that can send requests to only one specified NTP server.
NTP algorithms for the time determination from more server responses were therefore not implemented.

The Network Time Protocol is suitable for embedded systems and constrained devices
forming the modern Internet and it will arguably find its place among them in the near future.


%Refid~\cite{rfc5905}?? - not necessary

%Ability to communicate with more servers. Requires clock selection algorithms.

%Advanced clock discipline algorithms -
%The clock discipline process is a system process that controls the
%time and frequency of the system clock~\cite{rfc5905},


%It is useful to provide an
%initial volley where the client operating in mode 3 exchanges several packets with the server in
%order to calibrate the propagation delay % ntp/algorithms.tex
