%=========================================================================
% (c) 2011, 2012 Josef Lusticky

\chapter{Introduction}
Today we live in a world where embedded systems are part of almost every electronic device.
Modern televisions contain embedded systems to allow you to browse the Web,
modern cars use embedded systems to control an engine or to give you summary
about your journey using GPS, even fridges showing the list of things you should buy at a market are becoming popular.
Embedded systems are becoming spread more than ever and so does
their need for a network connection.

Contiki is an operating system targeted at embedded systems
developed by Adam Dunkels at Swedish Institute of Computer Science in Kista, Sweden.
Contiki brings new concepts to the embedded world such as Protothreads and features
Internet Protocol version 6 and 4 support.
Since Contiki aims for maximum portability, it is written in the C programming language.
Contiki therefore provides an ideal solution for connecting
embedded systems to an existing network on many different hardware platforms.

Time synchronisation is also important nowadays.
Almost every modern system has a need for an exact time;
your video-recorder or home cinema automatically starts recording a film at a scheduled time,
your washing-machine should have finished the
desired program when you return home or your radio automatically adjusts its clock when the time changes
due to daylight saving.

Network Time Protocol (NTP) is the ubiquitous protocol for time synchronisation between computers in modern Internet.
Though being one of the oldest protocols, NTP is still developed and updated to conform to the latest
network standards. Actual version at the time of writing is NTP version~4, which updates its previous version to
accommodate the Internet Protocol version~6.

This thesis describes Contiki operating system, its concepts and philosophy,
Network Time Protocol version~4 and design and implementation of NTP client for Contiki operating system.


\input{contiki.tex}

\input{ntp.tex}

\input{analysis.tex}

\input{design.tex}

\input{implementation.tex}

\input{measurements.tex}

%! finish
\chapter{Conclusion}
The Network Time Protocol has been operating over 30 years as of early 2012
and remains the longest running, continuously operating application
protocol in the Internet~\cite{ntp-y2k}.

The developed NTP client for Contiki OS is able to use the NTP unicast and broadcast mode.
The implemented time interface extends Contiki OS toward real-time support,
while requiring minimal memory amounts.
The unique timestamp conversion provides a perfect solution to avoid the floating point or 64-bit
arithmetic operations.
The measured results show that the Contiki NTP client is satisfying for keeping a reasonably accurate time.

The Network Time Protocol is suitable for constrained devices
and will arguably find its place among embedded systems in the near future.

%The implemented clock functionality




TODO - Future work:
It is useful to provide an initial volley where the client operating in
client mode exchanges several packets with the server, so as to
calibrate the propagation delay and to run the Autokey security
protocol, after which the client reverts to broadcast client mode~\cite{rfc5905}.

Refid~\cite{rfc5905}?? - not necessary

Ability to communicate with more servers. Requires clock selection algorithms.

Advanced clock discipline algorithms -
The clock discipline process is a system process that controls the
time and frequency of the system clock~\cite{rfc5905},

%Add timestamp into i-node in CFS.

%--
%ntpv4.pdf:
%SNTP is intended for primary
%servers equipped with a single reference clock, as well as clients with a single upstream server
%and no dependent clients.

%It is useful to provide an
%initial volley where the client operating in mode 3 exchanges several packets with the server in
%order to calibrate the propagation delay % ntp/algorithms.tex

%The operating system is assumed to provide two functions, one to set the time
%directly, for example the Unix settimeofday()1 function, and another to adjust the time in small
%increments advancing or retarding the time by a designated amount, for example the Unix
%adjtime() function. In the intended design the clock discipline process uses the adjtime() function
%if the adjustment is less than a designated threshold, and the settimeofday() function if above the
%threshold.

%An SNTP client using the on-wire protocol has a single server and no downstream clients. It can
%operate with any subset of the NTP on-wire protocol, the simplest using only the transmit
%timestamp of the server packet and ignoring all other fields. However, the additional complexity
%to implement the full on-wire protocol is minimal and is encouraged.


%--
%rfc5905:
%In the case of NTP as specified herein, NTP broadcast clients are
%vulnerable to disruption by misbehaving or hostile SNTP or NTP
%broadcast servers elsewhere in the Internet.  Such disruption can be
%minimized by several approaches.  Filtering can be employed to limit
%the access of NTP clients to known or trusted NTP broadcast servers.
%Such filtering will prevent malicious traffic from reaching the NTP
%clients.
