%=========================================================================
% (c) 2011, 2012 Josef Lusticky

\chapter{NTP client in Contiki OS}

Thanks to uIP, described in section~\ref{sec:contiki-uip}, communication is
not a matter for Contiki OS.
Contiki is also able to use Domain Name System for IPv4 address resolution.
DNS resolution of IPv6 addresses was not implemented in Contiki OS
at the time of writing~\cite{contiki-docs}.

----
The main problem of NTP client implementation for Contiki is therefore total
lack of real-time support.
Not only no common interface is available, but also
almost no platform-specific code has been implemented towards time support yet.
Contiki provides basic clock interface particularly for use of timers though.
This interface is common for all supported platforms,
but the particular implementation is platform specific.
----

Another problem might be a possible packet loss if communication uses UDP on transport layer.
The reason why this can happen often is explained in section~\ref{sec:contiki-uip}.
However, packet loss is not a matter for NTP if using either broadcast or unicast mode.
In broadcast mode, lost server packet causes no setting or adjusting time of client's
local clock.
The client simply waits without disruption for next NTP broadcast message.
If client needs to figure out it's local clock offset at the moment,
it can simply query a server using NTP unicast mode.

In unicast mode packet loss might occur either for client's query to server
or for server's response to client.
If client's query loss occurs, no server response will be sent.
Similarly, if server's response loss occurs, no message will be received by the client.
Not to block whole system till response arrives
is therefore desired behaviour of the client.

%TO COMMUNICATION: In Contiki the application is invoked in response to certain events
%... This can be effectively solved by NTP Poll Interval.

\input{implementation/clock.tex}

\input{implementation/interface.tex}

\input{implementation/client.tex}

\input{implementation/communication.tex}
