%=========================================================================
% (c) 2011, 2012 Josef Lusticky

\section{Hardware clock interface}

% TO NTP INTERFACE
Adjusting time - CLOCK\_COMPARE\_REGISTER = 31 => 128Hz => 1s = 1s
FREQ = 32768/8 / 32
CLOCK\_COMPARE\_REGISTER = 30 => ca132.129Hz => 1s = ca1.032258s
FREQ = 32768/8 / 31
CLOCK\_COMPARE\_REGISTER = 32 => 124.12per => 1s = 0.96p
FREQ = 32768/8 / 33

=> fastest adjust is 0,03s / s

% TO NTP INTERFACE
When writing to compare register, the value is transferred to a
temporary register, and latched after two positive edges of a source clock~\cite{avr-datasheet}.
The user should not write a new value before the contents
of the temporary register have been transferred to its destination.
To detect that a transfer to the destination register has taken place,
the Asynchronous Status Register - ASSR has been implemented.
Since writing to compare register occurs only once within interrupt CONTEXT, % context?
this detection is not mandatory.



This is enough for implementing a reasonable time interface and using it for NTP client later.

% ntp interface extending the clock library, similar to posix calls


Each TCNT2 increment is $\frac{1}{128 \times 32} \doteq 0,000244$s
0,244ms
This is also minimal possible clock adjustment.


Please note, that these adjustments will influence Contiki timers.
Applications requiring uninfluenced timers
are therefore advised to use rtimers, described in section~\ref{sec:contiki-timers},
because they use separate hardware clock unaffected by NTP client
(Timer/Counter~3 on AVR Raven platform).
