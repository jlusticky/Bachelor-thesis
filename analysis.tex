%=========================================================================
% (c) 2011, 2012 Josef Lusticky

\chapter{Analysis}
To keep, measure and resolve the time, a computer needs a hardware clock.
A computer clock is an electronic device with a counter register counting oscillations in a
quartz crystal oscillator with a particular frequency~\cite{thesis-sync}.
The operating system can keep and manipulate the system time using the hardware clock.
Accessing the hardware clock is done through the operating system clock interface.

On top of the clock interface is an interface for providing the system time.
To implement a reasonably useful NTP client,
the operating system must be able to set, get and eventually adjust the system time
through the time interface.
Though not mandatory, adjusting the time is an important function,
if the time shall be always a monotonically increasing function.

Apart from that, an ability to communicate over UDP is also required for the NTP client.
This is a task of the operating system network interface.

The NTP client is an application, that communicates with the NTP server through the network interface
and uses the time interface of the operating system.
It further calculates the clock offset of the NTP sever's clock
as describes in section~\ref{sec:ntp-algorithms}.

\begin{figure}
  \centering
  \includegraphics[width=13cm,keepaspectratio]{fig/analysis.png}
  \caption{NTP client overview} %!TODO
  \label{fig:analysis-overview} %!TODO
\end{figure}

In order to develop the NTP client for Contiki,
the operating system Contiki and the hardware platform must provide the necessary
components, as show in figure~\ref{fig:analysis-overview}.

To develop and test the Contiki NTP client,
the AVR Raven platform with the 8-bit ATmega1284P CPU~\cite{avr-datasheet} will be used.
This platform features the IEEE~802.15.4 (Low-Rate Wireless Personal Area Networks) link layer support.
Together with an adaptation layer called 6LoWPAN (IPv6 over Low power Wireless Personal Area Networks),
AVR Raven is able to communicate over IPv6.

\input{analysis/hwclock.tex}

\input{analysis/clock-interface.tex}

\input{analysis/time.tex}

\input{analysis/application.tex}
